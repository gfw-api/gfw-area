/* eslint-disable max-len */
const nock = require('nock');
const chai = require('chai');

chai.should();

const { getTestServer } = require('../utils/test-server');
const { mockValidateRequestWithApiKey } = require('../utils/helpers');

nock.disableNetConnect();
nock.enableNetConnect(process.env.HOST_IP);

let requester;

describe('V2 - GET download tiles', () => {
    before(async () => {
        if (process.env.NODE_ENV !== 'test') {
            throw Error(`Running the test suite with NODE_ENV ${process.env.NODE_ENV} may result in permanent data loss. Please use NODE_ENV=test.`);
        }

        requester = await getTestServer();
    });

    it('Load a set of areas in a zip file should return a 200 with a zip file attached in the response', async () => {
        mockValidateRequestWithApiKey({});

        nock(process.env.GATEWAY_URL, {
            reqheaders: {
                'x-api-key': 'api-key-test',
            }
        })
            .get('/v1/geostore/bfff17f7b4ced7a87de4901cc18dfa98')
            .reply(200, {
                data: {
                    type: 'geoStore',
                    id: 'bfff17f7b4ced7a87de4901cc18dfa98',
                    attributes: {
                        geojson: {
                            features: [{
                                properties: null,
                                type: 'Feature',
                                geometry: {
                                    type: 'Polygon',
                                    coordinates: [[[151.216155253351, -33.8816599631516], [151.189458891749, -33.8752497580509], [151.186911128461, -33.8463267310437], [151.21794462204, -33.8374052949163], [151.226132400334, -33.8670390152897], [151.216155253351, -33.8816599631516]]]
                                }
                            }],
                            crs: {},
                            type: 'FeatureCollection'
                        },
                        hash: 'bfff17f7b4ced7a87de4901cc18dfa98',
                        provider: {},
                        areaHa: 1301.01085370641,
                        bbox: [151.186911128461, -33.8816599631516, 151.226132400334, -33.8374052949163],
                        lock: true,
                        info: { use: {} }
                    }
                }
            });

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/4/14/9.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000075049444154789ceddde16b5d671d07f0e7a646615a3a614215d1218b81fa2228528415b52faa149ba56c760b652584d28eac33558211532821e25e44862fe64bcbd01732ad6972ef2914ff85be91bd3072cec9c4370a03bbad2075ebb65e5fc865594cd37b937bef73cf399f0fe445eebde79cef9bf39ce7fc9ee73c2704000000288674ae713c7686221b8a1d00f6a2f6af7b076367000028965aec00b017d9b36bcf35876bef8410c2e82b13bf899da768d400a0c23400145a73b8f6ced03fef7e79687fededd8598a480340b17d71e8af218410d2bb5f8b9ca490340014dae8e2f8cd70f0137f0bb7dffb4cec2c409fad2f2723f977affe3c760e20927cb631915d6c9c889da388dc02500acd3bcd4fc5ce0044b0be9c8cc4ce50547a009442ba981c8e9da188340014dea1f9f13c0c857763e728220d000000000003cf1020b0ad7429198b9d0100e827b70600c087f40c3eca4c40000000ca4e2d002a68bb75032c270625b2dbabbb5e01549ce9c300d04dbad783c944200008e17faf1b8f9d011870d9c995f9fc2bbf7d35760ee03e3aad3b743a02909f5d3d63d4004a2abd941c492f254762e780d228f26880c6000aea410d4f3b5d79dd7d0000a8847cb631911f78f9cfb173f48299809456d7eed9fff1fe97466effe0ab5dd917000000d0553b4dda29f264a46e5304a4943e3810dec8e6eac7b6fbeee36fd73ebfdbfde65ff8f59f769f0a288c7ca67e2a9fa99f8a9da397f40000184cdb2de3fdc06da6eb53e6edb7a7163b00744b3edb98680e37ef34f70fdd1e5d1cbf193b0fd067bdb8f2e7936b17babd4f20a24e8602d3e9fa542fb3c4e416804adadc001c9a1fcf636689c928009574687e3cdff746f3b1e1bf34bfd9fa4ce1100a607d3919e9f6c9baf1ccea0bd9f3f52777fa4d767265be9bc71c047a00001447ba948c6d373f6063e1fad11879808ac92e364ec4ce00a5b49bd97f45381630c0d6979391ec7c723a760e00a0dfd2b9c6f11dbf3757007a4315bfffcc030000a060ba71dbb09b4542cd03000080d2595f4e46bc4300000000fa6faff7e3db6dbfd7a9bda6064349a54bc958eb044f9792b1ad730e140861c0e44f5dfbd16eb7ddcd1b85f500a0222c1e0215b1f9642ff389ef694000000aaad38a7cebf73b15fef6b27fa08fb2a9b5e99dbeefe57dbc958ca024eed75038c9a162364f04022aa42a27be6140006869a7e2dfeee8c1a0d303804dda39f9b3a7aefd785fb3366c61502809557ea8b80775ebf399faa97e6501faa475f5cfa71a675b9fb51604dde996a02a2305506af96c63229bab1fdbfc59999f00dc4c11102a4c0340e5dddb5fbbd5dc3f747bf367a38be3371fb45d196e013e163b00c4b6af591bbef7d6bd87b77e9ece358e8710c2e84b4fdcd86ebbd1cbe3aff53a1b0000d013555df043111000da95cf3626626700000080224bcfd5274308217fec9546bf8fbdb170fd68f6f4b5d99d4603b2e7eb4ff633131041951a01c38000d00e2b074145e5936b176267000000f6acaa0f02856014008041d1cbab71bb4b78a5d3f5a95e65000006411916f6040000008042529c037a4603030000000000b1e533f553bd3e466b44207bfada6caf8f050c98cd4382e9a5e448cc2c40041b0bd78f6e5ef1375d4c0ec7ccd32f5604028010cc1084d2a8f2629fd0734e30a0b0b2f3c9e9d81980fbd0c3e83da300000000145d3f9e21000688aa7ee714010100000000184ce9747d2a7686a2330a0015a601a0b83e37f4ba053ca0e22ce409007cc87a020fa6060040315565fd7e00000000008012db7866f585d819a04c4c04820ad30000000000b067f9a3576ee48f5eb9113b07db530404000000a06d1b0bd78f6efe3f7f62e5a7b1b2d03e4540007a239bab1f6bfd75637ff9f8ca4237f60300ec55fef5df5de9e6feb6d6138001b0be9c8ce4538db32184909eab4fa68bc9e17ebd7c43a3d01b8a805061b5d8012886743139fcc143e1ad7d77c2a787de6c7ef6de23b5bf8710c2e8e5f1d722470362d8f8ced59f75f2fb74ae71bc57598048bc9e0b000000cac13d7e79957e18b0357c75687e3cdfcdf6f9b1ab2f865b770fd6eebc7f20fcfbdd879bff79ef9323b72e7ca3db398101919d5c998f9da108d2b9c6f1f45c7d32760e76cf4c40a07afa3587bdccd406a0a0f2b3ab676267007a68907a39e95232163b03ff4f0d00289ffcf1575feee4f78374b5ec956c6a6dba6fc7bad838d1af6341dbd2a564acddeee8c6c2f5a3d9f9e4f44ebfc91ffffdafba930c8862af57ffecd9b5e7ba95a5ec5a2b0ac140d8da1bc827aefde423ff9f5e9de96fa26aca8f5d7d31bd941c899da36a140101185cd9b7affe22760628bd415a79b7753be05903e813537bab470d00a8ae7ca67e6ae34cfd5cb7f6579409459daee8db899d56ffcdbfbffac35e1d173a967fef8f976367e8a7ad436d9dbeb4732fb709d9c99579af0d8702ca671b13b1330011b97a978f2220400821e40ffd723d7606809ef2f01200000000544cfead3fbc143b03719807000000502d4579841900000000000000000000000000000000e8c0d6578f33f82c0a0a0000000000000000000000000000507ee9b9fa64ec0c74c67a005061ff05d5e463ceae720cdd0000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/5/29/19.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000074b49444154789ceddd4f681cd71d07f0f1bf529396f4d0431a0ced656b884fa2e8a0824a20c5608c95989a3a751be1da244e4465631b12a4bac1555a2d25d420a73d95368542a99025ed1f1d4a4f39147ac8a137c1eedb635a0a39b5258526b6d48351593bbb9677353b6f66f7f339ed6a4633dfcbccbef77b6fde24094327dc5e3d92c5791af3b513599c07882094ab63b1330000408e6d2ed54bb1330c526361633276060a20ab22d45e0dfb050b00e9f08bd99fa2b488801e85f32b6fc4ce9096707bf548fbd05f73a672e9e17dfc080c97fdb1030090037edd0146c8bed801d212cad5b1d2dcf37f8d9da3c8768a955b1f1dfad2d1b9a9f7bbee57ae8e251f6e1d4bbeb2f55ee9f2b73ec82e21851616eb1361b13e113b07dded740376eb0e784e008658a35c1bdff96c187378190500189422ff7a869bebcf26c9fdd68011020aa9c81720000caff662138f2fdcaa1d4bbb75a3994fe634d101000032d39caf9e8c9d010000000000fa176ed58ec5ce901513ab000b76003084766be68e4233b8f9dadaabb133000312e6aa531dff7e7bf548a35c1b0fb36b17b2cec4f0b12418401eed34f3bbb50676136ed48fa79b08000000e866904392d6f063af8c02000cca284c4aa2b8b40006ec93edcf1ccef27c8d858d495d030000000028a09d577577dc76bd72c6fafe5020617a65be75ad7236760ea04f7b5976abfdadc8a15c1df39664c8a1f0dd3b3f8e9d010000184aea00009047617a653e760660483d6a58d163c59033b12fca517ae72183613d00008028c2627d22760620875a572ad3b1330029eb67dd3e2d05d2a608080ca7cda57a29f6501d0000000000407746326008b9b00160145903100000464ea7a702c3edd5230a840000000000d0890a3a905b6e50e485454163b87be8c96e9b9af3d593594681c2db796b6ff8f2cfff163b0b14891600504c0f4fa30ddffcdd72ac2cc080759c37ff83f58b499224ada3ef34b24f948ee6d5cab9d81900a0581a6fd69f8b9da193707ee58dd81960378a8000404ef432532e2cd627c2ecda8541e60172a2d348003002c2627d2276066044a5d1d568bd74e78769648134180500f22594ab63bbeef3e2ca4fb3c8d22b8ffa421f9ab3ebe7f77a8cc7b97164ad75a5321d3b0374939b2ec057df39fddbd6d77ef5e79defe1e53bd77a3dc6f6bf93a7bb6d6bbdbefe42bfd9f662eb5ff79e8a715e288c70f4179bb1333c2e4d7c86496e5a000000f7d7c6cb63510f485198ab4eedf4abc3d77ff3c7d879bae9e766d49c5ef9d120b2406184d9b50bdda6f0f633b5b775ad7276efa9faa708c830510404066373a95e0a33ab33a3b6d67d5e572982cc34cab5f1cda57aa9315f3bd169bba6340cb9707bf548fbf3fbcd57d62e375f59bb1c6eae3fdbbe4f94701969946be3b133402e34cab5711704e487222090ad9d45315a9756675be796df1ac43914e2a060ba150c81c1c8551760ffe7b7ff113b030090b6e699e5b79b6796df4e92240917d7aef6f2bfc33e5c0831e4aa0b00907b5e4e0200008a7450408a8030c2f67403786099acbb879eb4861f8ca84e95f170a37ebcfd7b636163b2b1b031995d2ae051f6c53c792857c7b63e39f0b9fd1f6f1f2efde4d49f62668151d4731720cd31f0ad64dfc1fd1f6f1f4eee6d7db67d9110201b8a8030c27abe013c73e55448ede4ffbdf744f2c4d687dbf79283a59ba7df4b922409d72b677a3d8e214828a050ae8eb978618499570f0000ec812e053cbe548601f374d11df8cff6171416e1f11c4ce32007feb9efa92449521b1e7c94b0589f48fe7ef799e4e9839ba5f9537f7978fbd1b9a9f7b3c801441216eb13add7d75f889d234992242f39a01f66020200000043a375a532ddd3fe336b2f0f2a0be4892220305a5a975667bb6e9b7c7723cb2c10dde652bd94e5ecb9b0589fe869ff3ed608c84aebdbcb3f8b9d01c848f3fafa7762670032d69ca95c7ad4f6f08d776badd3cb4b59e581342802020023cae3c3f09046b9361eaead7f2fcc55a76267c99b46b936bef339dcaa1dcbd37a08d00b3500e0d31ae5da78afe3f5c3a6fd6d45e156ed58c42890bdbdf68d8bd2b76eceae9feff872d3b9ea54b72e5058ac4f3cfcf25320671e35ed17465de16a00bdb62ab6b6f7a5f606e4f0e2f2625ac7823c28dc0d00288841d4009af3d593bb4dcb4d92fbcff4b7ce2dbfb5977315a586017d6b2c6c4c0ebac21d6ed48fc75864233cff875f76fcfbf757e7b2ce0243adbd8a9ef6f06173be7a32cde3016d9a572be7626700b2a708083c38bf1da02fe1e2dad5ff7f2e57c76266010000003ecd936d000000303a1a6fd69f8b9d0100c842f3a5d51bb133000000b9b6b9542fb5af990f145c63be7622760620a270f2f7bf8e9d01c899d6e9e5a5d81980f459120c00d845eb5ae56cec0cc000190d80d1a10600000000000000000000000000000000000000000000000000000000000000000000000005b1b9542fc5ce00c36a7fec00bb39f451f2c5d8190080ac8572752c76061856b9ef0200000000000000000000000000000000000000000000000000000000bd69beb6f6ea03df67d7cf27499234163626a3048221e6e5a000308afe07458b670027955b710000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/11/1884/1228.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000049849444154789ceddd5b88546500c0f16ff696bb8b285df6418974bd1068893d44d083841505412f69991814ac421029652941ac0aa6284abbabeb54b6baebec8c233d051514f8e6d3522da47b39935044186248d75d77ddeda9a008cddc996f76e7f77b9bc3996ffe0c733ecee15c2604aeab2f9d9f33d0915b1abb03002895fe7ddd8d495befaad81d500c55b10300ca56b2fd787bec0628167b00d731b6a06a7761f78996c1f6ecbca91ebb70287be7548f0944d0974ed7c66e000000000080bf49c50ea86483ed271facb93cf6c06853dda9659bd67e1bbb87cae33a801229bcd675ec9fcbaaeb262f4c5e99b8ddc64f2cf6004a64787fef23a98b57d685cb63ab96a45b16c5ee014aec5c676e79d2965d194208fd9ddd4d853d99e7623751d91c02400573085062031db9a5b5a3a9f993a3e3cda95b6ace2f7ee5e9d3b19b801248f6e59e1c6acbad082184646f6643ec1e2092426bcfced80d218470ee4866c9d09ecc33b13b88a366aa07ec4ba71be67c376b57b834f6d0c8ca86c7ef6979f687a9fe8c996071eb863763378410c2e485da6fc2dc89b9b13b98410adb8ea50bbb4fb4c4ee00aecd590000000000000000a068fa3bbb9b063a8edf16bba3c2a59203b947f36bf2d5b14328aeb2bb10a861ac6a6422553f1abba392f5a5d3f5a9eaaa4b6b4fadbd1abb0500000000b886e15d3d5b4fb7b64ef9331f8069c0c60f0000000000a592ece8de5e38945f1cbb0328b1646f667dec86e964b03dbf30760310c1d9f7f2b726fbb34fc5eea80465773b30c08c926c7eff93a4a37759ec0ea0c4863af3f3cf75e696c7ee0000000000000000000000006ece607b7ee1d0dbd9d5b13ba86c6e078e64a266a2313536e9fb272a3fc0486a2f8e3ff1fbe4f899d81d543613408915deca6c4c36bdfb75a8495d5cb1f5b95fff759d978f7e96a4738b4add46e531014005330194d878d34836b5b061c72ff5573ef87359b22bb325d9f84ea1b0e1c8640821841fc756a73effe9230fc684192ad97962dbf0dedee7ff7afd42fa52f2fab19e104228ecec7975a033bb2084104e7775cd8a940814cbf0c1930fff97f5922d473fceafc95717bb072843670ee4eb8b35f6505bfefe628d0d94b1249d5b3478b8f7ded81d502aa9d801506e9c05800a563113c04067f6ae1b7dcf607b765e315a803237d89e9d57d87cf4d3d81d504c15b30770a3ee7e69ddf72184f0c5c1aeb9b15ba0586a6e64e5b3adf9babad9571f9bac9ff86ae98bebcf172baa5c5c6d9efd466375581042f832760b000000000000000000000000000000000000000000000000000050b6f26bf2d5b11b88cb9f8356b0fbe6fffc61ec06000000000000000000000000000000000000000000000000000000000000000000989efaf77537266df93b6277501c55b10380786a620750de6a1a66a57eab1a49c5ee000000002ad7f0e14c73ec86e9ce59000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fea7e1c399e6d80d105355ec000000000000000000e0e6fd017ef3083e1572ad660000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/12/3768/2458.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000012149444154789cedce3101000004003059b5d24d173e153c5b8245000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0aab3a6b3e6fb01000000000000000000000000000000000000000000000000000000000000000000009c05dea905ad63d72c660000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/8/235/153.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000123f49444154789ceddd7b7054d77dc0f17377572b2c9647c1961d65e4d24112a82a853294f19810c68ec78e5d3c08a191d3d84dea149b12c14cc14e6a270dc5aeebaa62b43b1969bb6686364de2dae3d5bee83f9da4af693a7e34e9c3aa67bbabbdeb8431361ebf001b21601ff7f60fbc648d25b1cf7beee3fbf94b8fddbd3f3deed9737ebff3100230a9a950ac5d760c80a94d8562eda9f1c43af5687cb5ec58a647e277671f7fe15119d7a6b1a88d223b00d46e7a247eb77251bb51397b699ddee23ea32c769fea3e3cf837b2e2c98e456feb7a64d7bfcaba3eaae7921d006aa76885ebc462f1a6dee679433997ef5184e69119cfa545c59fc9bc3eaa47036041c963e1154208a1b5b8cf5ef029ff2bbcee0f45a1b8347f63cb8f65c6d5373c3423f3faa81e0d8085adfdc6c0bf2c7ea7d0af14f4c5e25cee577bf7ee3c213b26580b0d00e060340016d4b77be8b41042a4c78f77e86d2d279445cafb62f9a28cecb8ca6582b15ea3af990c867d465fd3ea68002c489d88f4654627b72b797db52e0a5ebda02f1605fd3ad97195eb191e48d5fb1ad5963617ca4194f226f824ca8016a38e456fd167b45e65a96b2ae72d665a2fba7f5bcf6b4b95ecec57ba8e7d7597ecf8602df4002c24190cfbc445fd666589fbe78545aed34208916f55de1242087d99372d373a58110d80c92583619f3a16bda5f479f7b707c3c5a2707b5cc25d7079da3ca7f2bf233e28ae171ef73999711a291b4c74963ebed6b87f2a146b574722f7363f2a6ba201001c8c06c00492c1b04f0d4437cef56e567079daba1fd9f58a10bf4c72b984eeeadeb3f3f5b6a2768376bdf745a1e82ef1f6cc9d9943937b8c8e5d86aee1fe93a9507c9510d79e7cb47eefc0bbc2277e6e4860164412d004b2c144a77e5eefd55bc4bbf925f937fa760f9d4e4dc47a7af70d64a642b1f6b6a27683a2783ed272fa4a45d7976933c5cfe8bfe2fd89bb50b84949cf3e2a5c22a7eb4a4bf7330fdc2ffb67b19a6430ec73f20c46cb370076fa036682b15ee543bd4fb8f44b85c59e13398ff68e57286d2d9a52d43e286e55ce176fd6db94775c3ed7097141b4173dae8fdcd98f76eb1ef7457da93bdd33fabb7f26fb67b092a950ac7dfdde817765c72193a51b80e4b1f00a6f46df53bcc9fd8f6b0f0efe677963901d8bdea6b95c677a0eec7c55769cd52a25b9f45cf106ddab5cc88bc2c916e1e97409d74cd770ffc94c30d6db333c904a4dc47a5a4ee5ef152b5b5fee7aa4ff25d971db9d9dde6c6c430d44370af1c9891e6a20ba31138cf5aafed8b64c20bea13c8b3e976430ec4b8f1fef6876ac954806c3bee4b1f00a1933e9ae56fadd9a11137b1a832420e060961e02944cfb135b0badb9ff69c9b574b9b2b37bf57397ba950b85cf8a56f77b5dcffec1e74a8fcb04e21b94f3853eada878d6fce9e0f7b363895b759ffe4e21afbb3d2d4ab17bcfced7b3c144a796d357eabaf08a9c58b9e6b19dff20f3676b84f4f8f18eb5fb779c921d47b5eaed724f8562ed6d2e6549f79e9daf37322e3bb17c0330ed8f6f767d54fc8dd24e38d9877ff0bc28684b74a1e842d35abafff6c12f963f3efbf567bf7769a3f7112184705f685da42b459fb6a8f07e69818d1042a442f15539a1cf7a85d2e679aff8b9ee4383cf0a71796cae09cdd78879ee8d961a4facebdddfff5ad35e3f145fc57263fbb1fc1060cdc19d3fd5155d174208f59bcf1f165ef759b1ccfb7f62b1e7a458e2fd54fdb7ebaf1e78b06ff7d0e9bedd43a7ddb9c2cde5377f6a3cb12e190cfb3cc5e2e2b6b70abb3cb3da4d62a67865d659d770ff49c5a3e48cfbe9ae2d359e58278410cdbcf98510a2d69bbf517bf5d5bbe7a119722a6882d444ace7eaaf258f8557a823917bb387c30f0b21c4f468e41ef570e46bd903cf8d961e93f64736cdf51ad960a233190cfbb24f45ef134288cce8e4f6eca1c843571efbf10414d9caa7c31aa9d4e0c01e2c3f04984ff2587845dfeea1d399407c83d226ce1573ae0bae82d6aee8fab2a2d0ce2be7449fab553f3bbbccfdb2472bcc7acfb9b6e82ebda5d8e6cef4ee1bc86483894efd4cfef3c2eb794f3993fb4d6d85e75591d7962a4b95e9ee7d8349d93f9f2cea81e7fea23bf0e5c7ab790ef576f3b2fc100000ae28d58793c1b04f3d1a5f5deab2ab23933b4a8f4907a25bd491c8bda5efa58fc46e2f7f7ef99cfca950ac3d1b4c74aa63d15b92c1b0cf29bbce2c347637f3fc00e08af4f8f18e6430ec2bbff9b387220fa9bbbf9f500f3e3fa23e1d1dcc8c4e6e2f7f4ef93f7e293790792ab24b88cbfff866388003d5a9255fc244231bca3e1de92f7d5ccd1f38190cfbd24762b797270ed118b29299000c64e4d049fdf6e41f650e4dee314bc506a85a697d8293cebcabe7862d6f6052a1f8aa697f626b4382b239aa000060846abac14ea93600f8d85428d66ee62e3f151000a642b9ae3ee4001c46f5c7b6c9ea6594927ca9507c553698e85427227da5ef6502f10d42547f4317f21ea947a2036832ca79cd430f0070301a00985e4ee8b3a58f4b7b26ca8c070000000000ab91b1bd573d331caf1efb9be52c072b23090800a85ff9c41e00001a8715729735eaf750be551a003414db7d01f814e6f69b07550000f6943912bda3fc73e6900370a47af60068f6589ee4ae83f0c7c642e8a5999c59a75fb20db4f15213b19ef2c3568c507a03a1a100244b8f1fef98ebb4a45a370f5da877c80d0f9844337b8199c3d1df6fd66be3d328030200aa77e5787593e685841022138cf5ca8e017532f33f18004008913d1c7eb8fcf34c20be213511eb69ea35596f009813093dc006646c1d5662e6b312ed802a0000606ecddae68b29e1e6400f40224bcc6e9bd1bb9af1b27dc34333953e96c6029064be3a3a3725000066930c867de940744b2610df203b967acc3744925995b01b7200808329b2034073a847e3ab95b7f35fc8aff4bedcbbbfff35d9f1546a2a146bf716c5f2de7d0319d9b100865003d18daa3fb6ad91afc9041a00622a146b9ff627b65a216b6f89b22800009060da1fdf2c3b063ba10a0000688ce4b1f08a5a3705051c29190cfb6addd69c6c3fe0604edb2e8d1d801ca4594b51edc2ee65336e769332aaa6ac4e44faecfe4f6e67fcedcc8f2a0000f3491f89dd2e3b0618a7bc57b9d05efed3fef866f6fa6f1c8fec00e6b5c89d961d028c53be4390e25172a58fb363d1dbf4bcee2df85cbfd094c2a935c33b7f2a27427b327c085069fe60edfe1da79a1d0bcc473d1a5f5dc8eb6e212eaffb2f783dd3dd8f0dfe485b54785f766cb886f96e6ea795aa9c4e7d32f2402dcf5b28696885c54c00c4e5e5cdb53c8f9d7e8c47150040f398b9eb66f53df3cc8c619f43a947e3abd591c85dfc035487c608b6a11e8dafaeb40148fb239b9a1d0f0003357a7f3b00cdd19424a05e282ec90463bd661eff03a00a00a0199cfcee9f0ac55709e1ecdf010000cec0da775811398046b92472e59f668389ced444ac475638004c6cbefc807a38f2b5cc91e81d46c70367a207003818a7034b30ed8f6f76cd16ba358fe7b4f02a336b0ef6ff7be97ba989580f27e3c228340092a8fed8364db8345d296a6b0fec7a51763c7026860092e45a0bffa58bc2058fd7fd86ec58001868be8d2f38e507000000409d4afb3230bc004ca6918b8538470f8e545a796765ac23006a64c525b78d3ef558f6ef407d22fa7b7668880134113d1df36122100098811d1379b2872780ad70de026052e5b5f64a3703491e0baf6856028dc60296d1e8cc3800182e7d24767b2dcf9b7e22f2d5395fcfe07771c6ecce42150080bdd8e15dacd29a7933e6f8933bc0bcccbea824190cfbb2df09ef939953c80e3ffb8cd1d7acb5d1cb0463bd577fcdec7f63e09a324f46bf2c3b8692697f7c733dcf5fe8864c1e0baf981e89df3dd7f71a515d4806c3bed2f5d53f8f0ca9df7ae18010977b096c7bee304ce5ac8e3a12b9ab92c74d8562edb5f6589a554254fdb16d99407c43f94d9e3e12bb3d333ab97dcec78f44ee6d461cb000a78c194b375b3698e84c06c33e7522d2576977b9da1bc40e790c981f55000074ef2b511a6ba703d12d953e277b28f250f322320f3bae63c002acd4edcf8e256e951d03000b60ec5db9a950ac7dda9fd8ca346eebe26420d4241d886e71b7e867c507ca46218428aef0fcf3dafd3b4ec98e0b301d23b7cbca8e256e6d767d5e0d443736f3f5611caa0000accd4919687214804559fde6ad746623009b52c7a2b7c88e01006055f31d8f8d6b5b28dfa11e8daf363216581f550000b083e9d1c83db26310827525405db2c14467f9e421a6da023085e92727bf4425007010274db4020000c09c4afbe091ed05acadaafd00547f6c5bb1c5adba0a5a7bb1459ff5cc68bf262eea9dc565aed4da03bb5eac25806430eceb1b1e9aa9e5b900ea73cd8940a9f1c4ba2b8b58162b6f8a7cbea3e7c0ce57736e7136b7447b71f646f7dfd77af30b2104377ff5e879c130a5928f7a34be3a3d7ebc838c30e010e9f1e31d99a722bb8c7cc7b1fa92592ba12701d602000e76cd24603a10dda25c722d2d5c9fff8fbedd43a78d086a2a146bf7688559f20300000095a8645c4f9e05002007ef4080395005000000301d864bb03d2bcc48e346040000f640af0654010000800d6502f10db53cafb4ed19009806e37658d2f493935f921d030000000000688cb43fb2a9d6acbb15501980dd547530c842328726f7b82eead7173a5bbfe73997dface7f4ebc522e564f763833f6ad435009850f25878457afc788710974f92a554055803538101000000c8960ac557c98e014083a526623db263984b2618eb951d03601b959e226cd60601d746a5c71ea8020068bcd2bc000000805f6ae656e0b5ccd9b7c2d6e4004c26fb74a45f760ccd44c30847e11f1e4e4215000000984cda1fd934dff7a6fd89adf5bc763218f6654627b7d7f31a002c6cda1fdf2c3b0600b08c4aa678030000000dd4e8bd0258d50698041b810000806be3a00ea03ed2a702d7b32b50eb45bd9b614373b05b9333486f0000384c2610df50cf84123b9f3f389fd478625d6a3cb14e761cc082ecbe3e7e3e56cf47b00c1aa8513218f6193d9f403d1a5f6de4f5e0507575d53fde6f9fc9369531eaa626718a8aa82391bb2a7d6cda1fd954493738bbe787cfd51795b9a813913ed93100b5a20a0000004c4c76965a1d8bde22f3fa4033586608d0b77be8b4d4005c2227f5fa80994c8562ed56992ebad0de8232a923933b64c700d81ec77f0373b3cc100080249923d13b64c750092b9d489c0e44b730b71fb255d40370fdf799914a1e277b8699c7a5bb655ebf52a989588fe76767bedbbbbfff35d9b1c0d914d901384d3698e8d4a667bfa1e4b4e5ddcf3cf015a3ae9b0ac557695afefdbee1a119a3ae09f35bb007504fed9dc4dbdc2eb5e6ce2b7dd77dd7c89b3f3d7ebca3e5547ebbe752cbaf67ff6472bf51d785f9d1037088a950ac7df15bc5fbb4cfb8ff292f0a27e9094008aa0000e01c56dfb80406913df71e0000d8917a34be7a2a146b2f6da86174d7d44a93868066210908c0b9646de965959594802dd5b3d92900d4856dbd0100988f11dd7426c6c0c9a80200702e19078d3af17053d858ad477fc9e87e734c195027a36edcf25d734b6b1392c1b08f750a80cd5d9d0024590718a0d4454e07a25bec3a5b8d7500c06554010007fb4403509e20d317b9deeadd3790313ea4e6f3e40a6b64c700589a95a7b24efbe39b65c7009856a92750cb3eff64e8010bcb06139dd960a2b3913732b577c09c3e910348fb239bb4f3f9f5794d2c6fe471dc4edf827aae9e54762c71ab8450804fa00a0038d8271a00d745fd66e543d1e57669055901d951efde9d27aefe5ad723fd2f09c1f0080080ca4c8562ed763a7790aa09646af8d980e9f1e31d6bf7ef38d5e8d76d1475347ea77ea1f059e582d6de3d72df5fca8e0790a9e14940236ffe6ae7f4ab81e84691f9e8eb42715d52deb9f879f5febf7ea959b1015640150070b0a63400462dddadbab7919c3924de3ef705d72f66ee3fbf79c98362fd8ac3eae3e1834d0a0f30bd86340099a72707ca3f5fbf77e0ddaa5f6374727b2362994f3a10dd225a3da7b5cd37edd3db3ca7daded5ef52162b29b1cc95cc7c27f287cdbc3660560d4f029a95fad80b7f2c96bbd2ca9bb97bf4131f0eeaeb573ea1aff4bea2b7b8def4b87477d770ffc9465e2f3d7ebcc39d2f76771f1cf8b746be2e803a641e7dee29f5eef14bd9877ff0bcec5800d94802020e66480360a6fdfc94f6eb7ea2dcd1f1c5fc6f2d795c762c80ad5d7df2ae13e6bdab7b7ef8acbaffefc6b38fbff0a8137e5e585b553d80ecd391fe6a1edfbd6f3059fe79a396059b79faacd2e23aa72cf19cd0f2c5e54e5f060df3abaa01e8fad660a25117ce8e456fabf5b98ddcaba0d1b4659e94ae2bba686f7945762c000c963d1479481d8ddf293b0ea01254010007a30168305d13deee6feefcb1ec380000680c2b9f0300c020763d4f703e574f7232d3a427c07064c001ebf87f6e4186f13fd935470000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/9/471/307.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000023c49444154789ceddd316e13411406e02114244d8a48915ca24844a2a08990b800053d2d881b2415377045a408d93134961b528d6cb80035375825f1e60c29e822904d65890217bbcaec2cdeefaba6d9f7fe66a79a3713020000d0210f52152efbf1edf251b80de1e1dde1fbd7df53f5015aeaba3f7d973b035051933f6e318e7b4df50200aa2827713f65fdf9c7e98b94f5817fdbca1d0000d834f34fb383dc1980ffdce5e76f8f736700000000d6bbf9f0f555ee0cc07a49cf012c7efdee85104279f26572398ccf52f6021a540e2e7657ebbae7f98b51ec15a3d8bbbf54406de5f9eca8ce77f3d3d9cbbf3704000000000000a0d34cfa413e6e040200000000000000ee9d8b410000000000000000000000000000000000000000000000000000e8b07270b19b3b0350df56ee0000000000000000000000000000000000000000000000000000000040351e1485f6f03828000000000000000000007453318e7be524eee7ce015467160000000000000000000058c315e0d06e498f022f17db4f7f9cc59d943d80facc02000009191906000000000000008016b91a4e9f1bf281cd6016003aacf206b00c8bbb27c76f7ea60803000034ae18c55eee0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b7f000d5651b5c7fa98700000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/6/58/38.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000098049444154789ceddd5b8c5c751d07f033db9662245c1e1a6fc04bbbd490959a3469c434258454b412d6a55a0a91525ba40aa12da6c616746d298d5be926dd153084706943c37661cfecf862401f147d456362d6ce9cc1076f89692048509076777d80c55ef6323bb7ff99399fcfdb9e9d99f36dbae7ccfffc2fbf7f1401000000eda47ca070fd74c73b9a1d0400804a14fbe2d5a133000000000040639d385c581e3a03404b70c304208cf2a1fccad019c8866430bf347406609e8a07f3ab4267c8328b8168a8b9be993b4e4e7ca659598014293f387a6be80c59a70500000000ed6da61261b498f263a35784ce00b4a064707849e80c000050479e8f01000000dac389c385e5691bce4c768d6c0d9d810c5004835a590d0800d072c606e2aed0190000d2add81faf089d61becc6805a8b764dfe88dc5be7875e81c108a6140209b5af17990d696b6598b0040da693d0000b52b7d67645be80c9049f36dce4f37e53b7924beb6d61c860101a01974e4410b69c46a4b855cc8bc62ef684fe80c000061e8130000006690ec8cef0d9d01008054281eccaf3ab370a44227006daad49b5f1f3a03000040bb49c334cd3464000298baf86d00da1eca070ad797768f6c9eed35a5bec29a26c5a1995ae1224ed61f1d0a9da19d150fe46f286f7f6157e81c675212ac49aede71cb1f4367984be7c8a68da133b49ba9f9196303715734915b3c11e54e85ce742637009887f916e27ceff4c425630371d7a2373b3eb5e0cdf1cbaf1afcea40a3b255c30d00002a51dc3fbaaeb46968308ade6f0d94f615d6267bf27754d27957c9884ea5f502ebd55998abc78740d6140fe65775bc9bbbecd4a5137f5ff8e6824f448ba3ff5eb5bbfb95d0b900805697ec2ddc1c3a030000003452f9d6e79e099d01e03c8d5c9dd90aeb45006845c996a1fed019389fdd82a14a6756436e1569aada6c3110000029a74622f0a1627fbce2c4e1c2f2d0391a290bff46e003a57d85b5a1330000d548068797b442b3dd302064981b003440e7f60d2773ef8e1bb1000080f656da1bdf143a03d0424a7d8535c5fda3eb429c5b272000d4a21e63fec583f955f5c80234499ad6f657c3d6603455f9ba27feb0ecd7db825c34c9d6e37db9683237f99f89cb3a9fbffdee1019a0edcca72a4f72dbb1271b99652ee543f99521cf0f0496ec1bbdf1bc638fc4d79e385c58ae322fcc43f99bc7f787ce500f592dcc69181080ea957b8ec4a133544239310068b4f2c6e79eade67dc9a6e77f52e728ccc23c0052a57ccff08393afbdf585ce97eeba2ec4f98bfdf18adca905974c5c18fdf3d33bbb8b2132405b4aba9ffd59e80cf5d40e7d0a460100a052edf0cd0f99d20a157aa12d24b71d7b32b9edd8d3699856ebdb1a326aeae26fc52dc4010000a05d34e2b93c6d1d7ec5ded19ed019e04369e90c33241745c503f91b426780288ad2f7cd0900900ed5940c6b85471d8b8100c8aef263a357a4a5831468b2625fbc3a7406a0c524db867b4367a8953e00a852eecac5bf099d0168906ae74794f615d6d63b0b9c25ab3bd9d4aad577f3ad378f00006487a9cf000050134d6a0000000000203d5aa15a0f0000709eb44c4252520c00000000005a4df9507e65e80c401d99050829d1a8f1f3a437ee9eeddb5b5565006817c9faa343a133002d626c20ee0a9d21341b83004025741e020064465ad69dd358fe9f21035ce8ef330a00000000406694f6c63785ce0000001fb0e9446315f7c47786ce0040d699a1d61856f14dcf4cc094e9dcbee164e80cede8d4e4e44766fa5d3238bca49a1b6fb9e7489cec1ad95a5b3298856faedae9439999160040bbd197002da474d7f0c367fe5cbea6ffdfa1b2000d56ec8f579c7bacdc7364248aa228d95bb8b9fcd9c36f4c1d4f3eff7839b9ee89df37331fd064c9e71efd73e80c648b4ec0c0c606e2aef2979efa65144551ee9a25cf45511495768f6c0e1a8acc700300a8b7b181b8abda9ef864cbf08fea9d8799957af3ebcb3b47ee2b3d307a7be82c0000b4bdd9f6b0e77ca6469349c9aa47ff123a431a94b6bfb8a3d817af0e9da35d180500a032c94dcfbc143ac374b328a165a9485b3fc583f955a13340c54a7d8535a133905dfa001a6caec940938bc6ff15eadc4095c606e2aed019a0565a000073695473bad1cd748f01d000e50385eb2b7a9d829400d0e2aa6d4e9bef1f46f9eee30f85ce0099537c20de98f4c6dda17394be75fc07a133a49d510000bde5e9a30395d4a9f58fb2bcf6c9dfd62b4bbb3b71b8b03c74063226b9f5d891e98e97778edc5797cfbf7fe41e0b5680b653ed8d4d533f1c9d8090616e002995ec1bbd71beef29ed2bac0db9bc78c18268bc9af72dbbf72b7fade67dc9ae91adc9b6e1deb38e751fcd57f3595995a91b40a54dcde4cbcffc7cdae3df183a54df44339b7877e2e3f37dcf553fecfe45eef5d35725f78fdcd3884c7359b6abe7d5669e6ff2edd39f9cbc207ae7cc639d854d3dcdcc408b6ad74d200c67421592af3fff78e80cd06c997a0498d56b6fccfb999bca6895a4971b0000000d34531d458f08e17804a06916bc135d3addf1ceed1b4e363b0b7ce8dc4527496ffcb5995e5bfaf60bdfaf66920e903267d6f5ab65e559f2dd78cbb4c777bc787fb59f09cde01100e04cc9ea9ffe29f9e253bf4a6e7eb6103a4b2b6966675e33a7659372537f78c9607e693d3eafb4fdc51d35e559177e075d6016c5ded1a62c1a09b530272d0cf101d038c5fda3eb429ddb9060e36945348e5100a0f5cdb65d77236bcecdb5476069f7c8e664d7c8d6469d1f326beac24e06f34b8b7be23b2b7d7db5a69aa2ca55434a4c5d94ffbf199cfdbc58ec8f5784c80534c14c1d44c5fe7845e9aee18767aaf34feb534ebc760b4307a8d54c2bc9c61746e30b972d7eb973f786579a9d89e6981c9fbc207486566714006036c6a1a1cd94b70cfd387486f92a3e106f2c1fcaaf0c9d234ddc9c995369d3d0e0b9c7927b5ff85e882c000040ea94768f6c1e1b88bbea555f80c6311780ba33771f5a801e6000a032c91dc71e0d9da11a9e756904538181f694ac3f3a74d6cfeb9e7e395416a04942d500d04c079846f9b1d12b8cda4046b9f8d34927200000001094dafbd0064cbe81f4320a0000a4483238bc24cddb7a99d802359aabe456b2277f47b3b20029e21b16a849a9afb0a67830bf2a740e482ba30040b614fbe31563037157e81c105acb6f0f5e89f7fb13165ddcb9bde7b5288aa28e45b9b7a35393172583f9a5e3131d0b179e9eb868d9ae9e5743e78466cb850e10423238bc24f7dea22b275f8fae8e164dbe15bd155d1e5d1cfdadf3a15b0aa1b3413335a40fe0dcd25869ebd1cf2db8e0c289d31d1f9db828fa47ee631dbf8b2eeb284f2cea3895f4c6dda1b34133fd0f9a623be99ee70d4d0000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/7/117/76.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda79300000e2949444154789ceddd796c1cd501c7f1b7b3ebd84e1cc58150876215575d6312d56a4214d24690468572a882d8490bb494230d86a6dc82a04212c4d9a8b5a3c431ae4b16ea729892e0f5ecf4f8a37f80aa0a68a16ab7d4d08d77463482206a945293d3717677fa47bad4041f7bccce9bb7f3fdfc65253bf37e8977debc63de1b21000040e1e2bd7aadec0c00000000000000cac060c4a8939d01800759dd4638d961ac909d0300000000000000000000000000d46046a2f5b233000000000000000000000000000000004009f0ba2c0000f2b167bbd1243b03fc41931d009f341831ea829a1d949d03ea1aea882ecdf5b354001ed3dcb66a5854a70fd07f46a1c6e684deb11eee6f919d4319d6d6d872dea8023fa2050000c9f6d832d9195466ddd8f7b879d7aefb64e7407e42b2031423deabd7ceda1f683a6b43cb6b859ec3bae5f91f8b54baca1e4dbfe86436bf09efbcfa26d91980bc24efe9bf2dd1156b969d038024d6a6fe36d9190000800acc07f42b6467009cc03420e063540085b00ed20200000000007859a22bd69ce8d11b64e7000000000000ce1a8c1875b2337806cb7d010000000000a01aa706f8580c0400e5862920000000002e8bf7eab5d9579cf1aa33601266245a2f3b03009484d3777f73476ca193e77382aa9538d3800020d3504774293bb54c8fa94de7d102902cdeabd7daa1d08105eb5bf7cacee265f15ebdb6eabde35f979d032889f123e600000000000000804998df7bf669d9198092609600000000c034b28b54e83e94de504774a9ec0c90cc8bcfabefd96e34c9ce2093177f275ec15a00c0c7a8001cd6dcb66a587686931d9d931916c2bfdd80ea31315b76062f323745d7c9ce00007083df571c96e3bf9df10d601a5c2480cf95e3dd7f2aaaee5108000000f81ce31713a07f03000000eff1dbac832765fb4fbc7403e5804a054051acadb1e5e6fdd16b8410c2ba63f7461603013e4605005ff35bb33a7c57cbab76a5f8d0bca9ef313b64a7a800e06b8bd7b68ec82adb6cd7574a297846707fa0a1fa37f619337e27a57c0000a428e51669891ebd2197f327db63cbcc1db185a5caa13cab535f223b0390afe4a681b5b233004a706300ceea36c2a52e430593554c0c0202000aa3c2c2ac78af5e9bdca62f929dc38b6801a028998f020db2334c67f1dad691404d66bf1b65a95021fade9eed4653729bbe88b5d6c54b74c59a656700000000000000e033f93c6094e8d11bfcb6221005727a8ac78c44eb7952cd59e53c0dc7770500807297dc1cbd5e7606c0978636f65fe7c479acadb1e5f97cde7c40bfc289720148666dea6fb36ee87b5c768ee9b0160000002f4876182b6467700df3afc009d6a6fe36d91900009087562100000000b8c7da327089ec0c40bebcbebddbc9af0133efed5f2f294a6eccafeef8487606603a2a0c1a26db63cbcc4dd175b273e4c5bcf8676fcbce00008072bcde25019410efd56bf76c19f89aec1c00ca44f6adbce3c70f54184b280556030200ca874a77f3448fde203bc38478e51350fe26ed02546881a36e06014a21d91e5b56f439ca787fbe492b80f0cdab2c378300a51078ebe0adc5760902a7055f772a8f32ace5db6cf3fa67fb64e7000a351831eacc75cfed949dc3cb266d01642ef8dcdad4b2591bdd0c0338a9fa80fd0511b4c7dc2a4fc59792300d08f858407600a014cc2dfa457685361a787ff4bcc6ad57fe48761eafa20500e5659fec13e27ffdfe48b4fed07c7162e0ee3fc7cf96d5349f68f071a823ba544696c9d002f09878af5ebb786deb88ec1c4e70ebdf92e88a356bc73273821581a347676afbaa86ed73c558ba3653a9edd7f61dbba8b1e7aa3b4b9d4155b4003ca65c2e7e2184a8fe977d4e7683994457acd9dca25f34d1e78a5d39b7e0d696c123a706de4cd9daa12a91aa1075e978e3436b9e19fb8cf6d743e7563e98eb794edeb4c30f6801a0a48636f65f1714814a9118b9d6aed00e35ee5a7b89104298f70f5c6dcf0dbc95ae12230bd6b7ee3577c41666c6d2b3b4d1e0fcc64d2dbf1e8c1875cd6dab869dce53c8799d6ac9c47bf5dad947b4795e7ac626243b00ca9b16d452e187563f65deb5fb94c0b1cc5c2184b0eed8bd31fcd0ea47c77fce4edb33b40381b3ec746ab6104254895445b1654f74e11652a984525a65b15984f8b875376275ea4bc2b7b7fec58973168b2e00e0637401e09a138375e92afb7860763014c8d863995976a5f8408840e5d89ca059b93fd5aca5ec1a3b143c323a4f7ba3145d805c980f472f6fdcbce65732ca761b2d00b866b4c67e371808569c7defea97ecf7c6ce0fd8414d9b113cdc74f7ea979bdb560d1f9b171acc5485decf644450d6c52f8410f95cfc4e2e3d566919b312f66c379a6467c0a795725e5ec64594eb2cc664b320008ae4a5bb271b82021e96dca62f2ae6f8c18851371831ea72a974bc54314d8431000000f235d55886d7effc0000000080dc98d73cbd5b7606c0092c06ca83f9bdbe9f8bb1f45c51a11d949d454566245adfd8b6669fec1cf83fa601014005e6e53be3b233a88ea7f4a02ceb826e690b640ae5d977dfe5c00faf25670c4021b69d51eef7b5607deb5ed9190a311831eaec54e6ed5c3e9bdca62fd23411f4ca261f2813d60d7d8fcbce0021ac4e7d49a1c7f2442000f8d1f8fdeae17d2a8f57148a694000809a9cdcf589161ba488f7eab52abe595625431dd1a56c11f76974013c60d68868088c85aa64e750552e3bfc8ccd09bd6307ed193c0804cf49f4e80ddc9d00a00ca8d4caa00b00005329a6466770aff4bc387a6f751b61d919e071c90e6345bec7145219b9f5382ae318eae1dd801ee0a5b7c516c3dc115bd8785bcb3f64e79061cf76a329382b75d81e099ea1cd0cfcdb4edb33fcfa7f813c64efe866bbbe5272949cd0a5f9343312ad4f6ed31779b12b020f496ed87dbbec0c5ea2523fd9ead4974c56f95129a2ec15b32416dec53420e0635400c849e6b8364b7606c0579c9cbe53a9bf0d009f42250640087162fa34d91e5b96ddc567e851fd52c9918089314d541ac90e6385b535b65c760e000000940debb2c81bb233e462a823ba54768693b9b10029dfc547ecd10f9409b79ebb4f74c59add2807c8cbf8bb994a3bd04041c907fbd7982b3a0fc8cee155342d01f8921b539c891ebd61aa26bf2a4ba9bd88b5000080d2726bbbb07cba63e3c74e18ec033c2cf960ff9aeccf273ffd375537249ff50356b7111e8c1875e6fdd16b0a4b09b8c4adc78b650d705add46389737fe385de6c97fe6c5672c80922bd5859f4b5760a863e0bcc92a382e4867b12b70193223d1fac6b635fb64e75099b923b63073d03e539b218e366e68fdbdec3c2892b5fac9978510c27c70e05bb2b38cc73304a51f20e47d0593631a1040f9b2beb22d233b83530623461dbbf3c2498c019431ab25f2ba38adfaaff69c8a7f0646ed5332a757fce1f067b55766ef4baf0c6ffe66ac9873ab34ce60b6eb2be9c74f4c992e8075d9e37fb7ae792a5af0f1373ff71327f32861deccb81042d873436fda236367698943eb16af6d1d29f6e21742082f5efcd9edc14e9e41e0e2f7b8524fed981775bf6b3ed0ffdd5296e15556a7be24b9257aa1ec1cf026ba003e301831ea42a94cf582f5ad7bf33946082152a1ccb1c56b5b474a160e5229d30500e03ce52b00f3be176e909dc1eb9adb560d074732e15c370eb1b6c696875299eaaafd992f85525a65a9f39502cf572826b9397abdec0ce5ccead4970c3d3070d5749f3323d17a7618826b18a0ca4f3117672e4b5e0b7d6a8e3bae8f99d73eb3ab90e3863aa24bcd0bbbdf733a0f80dc3832069069aaf94521c735ddbde6cfe28bf3769aad4fbc6a5dfcd3bd4e6401a018f674735ea2476fa0598ee9283f0b00009802cb61019fa33b00a5f16292e2c57bf55a2a0228cbdab0ebeee41dbb36bb5d6ea2476f302fdf1977bbdc52e2611f08a1c86220b3e5c93f35c6d67d5956f9d6d6d872fbc5e127c429d543627ee59f1a3baefcb1ac2c6e4b74c59a4323e9cf8b2aed40aa46eccd674111bc8f5900c0c794a8008ab9fb5be76f3f526cf9e1bb5a5e4d5d5a7765e083c3e704860e7ca7d8f3a924382a668ece0fbd96aa117b5321eda8ec3c40ceccd54fbe62b63ef147d93900a06c8c1f402c763091c14840016ebd8a0c9892f5eda77efbf1cf5b062e91966365d787d66dbb1e9255be6a78fec09b9418041c2ffccbebbe91fdd97efdc3fba505a9ad7a5b54691f492bdfc326dae4957d05bd49b90a0080cf596d7d3db2337895b535b65c95fefa50c7c079b2334011e6d54f19e6153f7fc9dcd07f27fdc94f6224dd597efa7e29d3050884b4c3625ef5df02078f35d09ff43e952f22be5f1e65ded8f798ec0c5e61751be1eccf8311a36e3062d4993b620b656451f9620794a3ca0527ab421a5f39626aca7401000012589dfa927c8f7172605295160f50d654995ecc6276042801f3872ffcc0adb2b888e1a86c7332d1a337488e8249c81a3c840fa8744791d9f72d55d9c9f6d832a7ce95e8d11b18f147de0623461d5f9cdc79b5d24cdef2fc23b233a88e6940c0c77c55019891687d76014af8e65596ec3caa686e5b35ecb53113b35d5f29e656e4fd3b4c6e895e683ddcdf528a4c5080579bb37047bc57af4d74c59a65e70000efc82e28919d036a706a96a098ef1cdf5740615cc0f2f96a1010000000b215bbb8c86b539380af25db63cbb2fd7a96f0028a71737e7ccf76a3c9adb200780c2bfe000f51e97d02700ed380808f5101e08423a9cf8c8ad071d931f2c560239455ce5fdee9a6e8928f46bf31d5dfc31d01d901e03fe63d2fdc2146c6c201db0ed967d6fcb67153cbaf6567f22bba00652edeabd716f3ccfdd0a3faa54ee6114288c091f4e9e270aa5e9c5df3b41d4867723d8e9903a00cecd96e34992d91d7cc767da5ec2c7e470b0000e06dd6f7fb3acd476297c9ce516e680194b962c70026e3f6aeca99532b13622c5db6b326b28464074069d5a43235f648e00c21c4b093e7757d53d52aed83c6cdab075c2d132817b93e73c0125ba0cc147b51273b8c150e4581c7fc17a9eb5dd52ec81eb40000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/10/942/614.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000031449444154789ceddabd8b147718c0f1dfaee212df88060459448418418440aa804452985e50b4b3b25048117c4114534492105fc8c9189c2882a09ede8dee36fe075aa43e8bc39d39cbfc0156e271baa9f2c281207ab7cf4cf6f3298781f936f3f0e3e19752cd3cbd36b921ba01c6453b3a60b155a9b325ba01c645ed06c0cae72f8f0fb2fee7d11d404d5459b133ba0100a893b90bd3fba21ba0a96ab7030046a79103a0fc71fa6875eedecf29a5346cb787d13dd054ade880f7554ef4f6b6e65f7f9cdac357db4f1d7a14dd034dd4c813404a290d175eaf6b0ddfacf6f3c3085427efdcacbebf7f36ba63a95559d699fdfde1f6e80e00000000a8bdd9bcbf2bbae1439513bdbdd10d0000c092aab2ac13dd0075d1d89b8000c0382a2f4eef8f6e00f84779b9f826ba01fef7e6ce4f7d1bdd0000000000002ca7415e74cb2bbd3dd11dd0548dbe0abce3d8c13f5bed341fdd014dd5e801008ca9f24a6f4f79fa6ef6df67d5d15b7f0cf2a21bd5044dd3d813c067dfed7fdcfaa4f3e4ef5b81d54f5347de7cbaf67cfbc57077741b1064e6d2ed35effaee202fba55d6fb72397b8045de764c9fc9fb9b46dd02d4447966f2d2d36b931ba23b605c347607007cb8b70e80c1af0fbe1a65484a292d6ceddcf868c5ea8da3fe2e000000000000000000000000d000d585e24074030000000000000000000000000000000000b0d84cdedff4ec6ab12dba030068aa415e74a31b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000783f83bce8463700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c01299cdfbbba21ba0aedad101000000000000000000000000000000000000000040802abbbbbe9a78f07574070000000000000000000000000000000000000000000000f0afb91fee9d7876b5d816dd010498bddedb1cdd000000000004b01c8477d38e0e580eab16e6574637000000000000000000000000000000000040fdccfd3275b8faadf74574070000f017c9878a209a9236340000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/12/3768/2457.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda7930000011f49444154789cedce3101000004003059b5d24d175e0d3c5b8245000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cf3a6bbe0f00000000000000000000000000000000001c0bd32b02d7b0c53af30000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/11/1884/1229.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda793000001b649444154789cedda314ec20014c76168698204e2e0ec11b8808b276265b509bb092a430762609084b330b0104cda1bb8180e609c3c0026f2dafa7d27f84dffbce1753a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d006d57c7317dd40b325d101fcde67ffb48f6e0000000000000000000000000000000000000000000000000000000000000000000000000000000000a0697645914537c0a524d1017572586c87d71f834974075c8a0100f891e7b95104000000000000000000000000000000000000000000000000000000000000000000000000000000000000008073bc2f97a3e80648a203fea3ea613d4bcbf4f1f8bc1d47b70001aac5e636ba015c00000000000000000000007f6a571483e3cbea26ba83f6f10adc00c35e2ffdea5e65d11db48f01000000000000000000000000000000000000000000000000000000000000000000000000803629a7afebf2e9ed3eba030000006ae81b6c8d20e07c2a29340000000049454e44ae426082');

        nock('https://production-api.globalforestwatch.org')
            .get('/contextual-layer/loss-layer/2015/2016/3/7/4.png')
            .reply(200, '89504e470d0a1a0a0000000d49484452000001000000010008060000005c72a86600000006624b474400ff00ff00ffa0bda793000009c349444154789ceddd5f685bd71dc0f1a32bff49963f5bba25a3b8d920b3aa121ab068c7f2e0e621b207bb8d226a171b1c080a049b108a29a35466a363a3a3663036b342da314608246b42e33f3ab3f6d03563cc4f7dc928a5dbd5b9ed20346cddd6943ae98cff5ded61b99e22644996a57bae74bf1f08c8fa73efcf8eeeb9e7fcceefdc2b04000000000000000008187b400eeb8e010000008027ac71d9ab3b06003ea1d2d998ee1800a021543a1b53c766cfeb8e03f0a520f40082f03b0200503dce8c40eb322abdc1595adfe545204161a5a4a93b06009aa891f9a4ea976775c70134859c29cfe88ea191a8b98076aa676642f5cbb3b9deb9f1ad7c8e2feff6b87f3f35329fd41d0b024eedb9fcebdc93732fe88e23a8587c05df5227e5a952cf6f35a1554b8f2128bd0c95cec636fb3b039e72a7fe543a1bab651a501d9d7dbe9af76db501b14fc8d3d59e299b35db4e82105eaa380d08a0753dd00058e3b2d74a49d3595adfe576bdcbd50114f6141ee8aaef09dfad267b1fbd98c8163fe76e273794192c7e6dbd4bdcee9e4e5c2d7ede1e90c36e2d7feec8ccf7734fcebd60dc11fb9a710621f256e257ba630036d4da955627e5a9ed76c3ab1d7e582969aa63b3e7dd46c0eecb8c5a2969e67ae7c69b6d5c6d8dc9b8ee188007a8f64b97ebb19d467eb9d5f1b973b9e8f4cbee01af7a662654cfcc84bb5ffb843cedc7b266fba1375edbecb5a024401150f60979bad1fb50c7e7ce6d3cee976737862d3ee819a8ee375f114208bb67fa7bba6301ca6ad4d9481d9b3d6ff76546bd9a07cf99f28c5fceaceac0d55775c7006853d803b0c664dc8f5df4465087ae4f6e3cde77e5973a6341b0b5e9dc79f76f1397367ed8219685b85f167bcfd91dc9242e0b2184fdad99efe6f7b67d26447364c8553a1b0bcd2c3dd36d0dbeb4e99b8c7c5e1d9efea1d3dffe96f8e3dadfc4a71e060814f04d1d40742ab11099346f3afb9d4fc4e1f0fb1bddf4fd6dff0a758a9550a758d9ee3ed491e99784a83cfe77672f6aea91bcb37a341fedb0cabdc5e9edfc53fef1b677a3538985c89f9f7965cbfb00ea24a43b8042564a9ae28b62313a9558a8e6fd2a9d8d4526cd9b55bdf7f8dcb9c88de4856ab6e92cadef7263c80d6506f35f082d452f26b2d6988c1b778ddd4e87b32a3ac572f883fc37d61f097d243ac5b258169de145b127ffd7b5c7c4ded0a23810fea7787ff971218410873bdf13b7d6be96df6dfce7d185e45435f1025ef0ac0750e96c6aa5a469ac18edc6cef0e7f5dcae2b72237921179d7e3967ca33e5a6232393e6cdc20628d4165e730b96c2b74557e4cad373d18b896ce8d3fc979c8fd70f18bf5bfa8ef197f5c78c77d6bed93d9db82a569c0ef1f7d52ef1fbc56f47ec672722f6b313e20f8bf150a758e1e04720d4d275ce0d6506ab291cb2c664bc308b5f8fc461a5598172afab27665fac47d113d012ac71d9ebfe737f2e7590965a035febbaf8c2337af1d97db3fd97dcceb8ec754b90b7124bb59714af769114d0b4724399c1dc5066508dcc27ad9434bd9adf2fee1914c653e9602e6e20dcf7573aab976b580a0b9000bfaa6b0ec04a4933d4165ecb3f1cfad8d9ef7c12bd98c8aeef1577cb7d66ab5721da6cbf628758169f89bdc5af85dac26be2a3d547366b88d4c87cd2595adf658dc9b87bc047ae3c3d2744e9c54a85ca2520ab49383612431268d54c5f406b4cc6d5f1b9735e9426eb1094022b6c5d436601724399c1f0bfc55784d8bc6b5e8aae9570e1dba22b722379e181c2a41692ff70ed90ee1880b2dc2e7a6e2833e8654360a5a4e997b501f5c2191f5ab95fc0e20cbc4a6763f53ab8eb39c4701396f5da9e6e6a643e592ef1d9aa431df8889592e64636fdfe41efd72f9edd9719b59fca3ca73b0ea0a5a9af5efb45f173f6977fa3355b0ea009d53b4fc0b819f0111d37caa01140d034641a703b07929719f9e26bf057bbb2b05915ffbf94baf232b02d15d7da97e9ba6fa56ebf1e8a1b1b77fff404000f94aad3f7fae0d3d9e0e852fc3bdb7d99515db100bea08ece3ebf71b7de4d1a8556ee19a863b3e75bf9f703caf2c365c201aff9e69a80daed36ee718beedad17b0002c61e90c31cf80824eee10720d054d7d59fa927665fd41d070000de60dc0be001f6801cae545a4be92dfc86694020c07c756bb056a046e693ce1ee79e104218fbc2778468fd4546002a206f003f62080004180d8087fcb21a10000000000000000000000000000000d088b25a00acb20300000000000000000000000000a025512a0c80526120e8ac943475c700000000000000000000000080fa718bc2a8120500000002873522000000000000400be3fa10104208618dc9b8ee18000000003404dd7d000000fc9f3526e3415d2168e80e00d06e5974ea0e0180662c100200000000000000000000000000000000000000000000000000000080d6a1d2d918d799839fb5e90ea09539ff587ff8fec39b5a030136c165c11bc85831da8d15a3ddeecb8cea8e0528851e4003391dceaa1042181fae1ed21d0b004dd4c16b3fd51d03500a43000fe48fec7c4f770c402934004080d10078207f50dcd21d0300000000000000000080865323f349f7b1352e7b75c682e0a20e0000bc50eeda00d6988c7b190b0000f00375e8fa64f17376d7b59feb8805000078a13837600fc8615db10000001d54bf3cab3b0600000000658b78b6b28dc2ed70d3102040aac9eeab93f29417b100f0909592a69592a6ee3800f848f130a0709520d06821dd01b42a95cec6229366c57b02da7d9951a723b49a3f286e19fbc277aaf90c009fab25c1475210082095cec6580e0c1db820080000404d18bb03000000009a0085403eb23115b8432c47a7120b9ac34100300d0804180d808f445f4fbc2d9645a7b133fcb9ee5800788c6a40a005152f03e6a220004a6239301050f4068000daecac4f6f008dc62c0000e8649f90a785f85fb2906100103074f5a10b43001f703a9c55dd31000000ddeca732cfe98e01408390e8835f90030080ed52ed972ed7fa5916010100000000d0fab86538746216000000a06614f7000000000000c0afb837a00fe4863283a1b6f09ab3c7b9177d3df1b6ee7800788ccb82010000000000000000000000000000000000000000c023aa5f9ed51d0300000000001ef3fbfd22b835180094a30e5c7d55082172a63ca33b160000d028eeb82d67ca33aa6766c21e90c3d57ed61a93f1c64506d417f7052841a5b3b1fcbbeb3d62d1d9fbe842724a773c40a3900404000000d048d6b8ecd51d030000bed7e8592592800000c06754f7f51feb8e0100caa2fa0f0050132b254d5dfb260908401ffba1375ed31dc356a9c3333fd01d030000009a9d352e7b7554c99203000000009a9afdf5377fa23b0600008026a0b3120ba896123ffa40770c007c881bf20200000000d0fcb8902e0000000000000000000000faa87436a63b06002da611ab56b92620000041f45f3732cd6dfc77b95d0000000049454e44ae426082');

        const response = await requester
            .get('/api/v2/download-tiles/bfff17f7b4ced7a87de4901cc18dfa98/3/12?layerUrl=https://production-api.globalforestwatch.org/contextual-layer/loss-layer/2015/2016/%7Bz%7D/%7Bx%7D/%7By%7D.png&useExtension=false')
            .set('x-api-key', 'api-key-test');

        response.status.should.equal(200);
        response.headers.should.be.an('object');

        response.headers.should.have.property('content-disposition').and.equal('attachment; filename=download.zip');
        response.headers.should.have.property('content-length').and.equal('21818');
        response.headers.should.have.property('content-type').and.equal('application/zip');
        response.headers.should.have.property('last-modified').and.be.a('string');
        response.headers.should.have.property('date').and.be.a('string');
    });

    afterEach(() => {
        if (!nock.isDone()) {
            throw new Error(`Not all nock interceptors were used: ${nock.pendingMocks()}`);
        }
    });
});
